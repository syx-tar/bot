// Send command for Telegram Bot

module.exports = {
  name: 'send',
  description: 'Send a message or media to a user by ID or username.',
  execute: async (message, args) => {
    const senderChatId = message.chat.id;
    const isReply = message.reply_to_message;

    // A recipient (ID/username) is required
    if (!args[0]) {
      await global.sendMessage(
        senderChatId,
        '‚ùå *Usage Error*\n\nUsage: `/send <recipient_id_or_username> <message>`\n\nTo send a file, reply to the file and use the command without a message:\n`/send <recipient_id_or_username>`',
        { parse_mode: 'Markdown' }
      );
      return;
    }

    const recipient = args[0];
    const messageText = args.slice(1).join(' ');
    
    // Check if the recipient is a number (ID) or a string (username)
    // Telegram IDs are typically numbers, while usernames start with '@'
    const isRecipientId = /^-?\d+$/.test(recipient);
    const targetChatId = isRecipientId ? parseInt(recipient, 10) : recipient;

    try {
      // --- Case 1: The command is a reply to a message containing media ---
      if (isReply) {
        const repliedMessage = message.reply_to_message;
        let fileId = null;
        let mediaType = null;
        let sendMethod = null;
        
        // Check for common media types
        if (repliedMessage.photo) {
          // Photos are an array of different resolutions, we take the last one (highest quality)
          fileId = repliedMessage.photo[repliedMessage.photo.length - 1].file_id;
          mediaType = 'photo';
          sendMethod = 'sendPhoto';
        } else if (repliedMessage.video) {
          fileId = repliedMessage.video.file_id;
          mediaType = 'video';
          sendMet
